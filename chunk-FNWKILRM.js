import{b as u,c as W,d as $}from"./chunk-752W7H7G.js";import{$a as I,Ba as m,Ga as F,Ka as S,Kb as B,Lb as k,N,Nb as V,Ra as p,Ua as h,Va as d,Wa as w,Xa as O,Ya as y,Z as v,Zb as E,_a as _,db as P,eb as g,fb as A,k as b,mb as M,o as f,qb as z,v as x,wa as D,xa as c}from"./chunk-YCY2TLIR.js";var C=class o{constructor(){}getCounterData(){return b([{title:"Utenti",value:1254,icon:"users",prefix:""},{title:"Vendite",value:8547,icon:"shopping-cart",prefix:"\u20AC"},{title:"Ordini",value:384,icon:"box",prefix:""},{title:"Visite",value:9841,icon:"chart-line",prefix:""}])}getPieChartData(){return b({labels:["Prodotto A","Prodotto B","Prodotto C","Prodotto D"],datasets:[{data:[300,450,250,180],backgroundColor:["#3498db","#2ecc71","#f1c40f","#e74c3c"]}]})}getBarChartData(){return b({labels:["Gen","Feb","Mar","Apr","Mag","Giu"],datasets:[{data:[65,59,80,81,56,55],label:"Serie A",backgroundColor:"#3498db"},{data:[28,48,40,19,86,27],label:"Serie B",backgroundColor:"#2ecc71"}]})}getLineChartData(){return b({labels:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],datasets:[{data:[65,59,80,81,56,55,40,65,75,62,89,91],label:"Vendite 2024",fill:!1,borderColor:"#3498db",tension:.1},{data:[45,42,60,70,46,48,35,55,65,58,79,80],label:"Vendite 2023",fill:!1,borderColor:"#e74c3c",tension:.1}]})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})};var q=o=>({height:o});function J(o,t){if(o&1&&(O(0),w(1,"canvas",4),y()),o&2){let e=I();c(),p("data",e.pieChartData)("options",e.pieChartOptions)("type","pie")}}function K(o,t){o&1&&(h(0,"div",5)(1,"p"),g(2,"Nessun dato disponibile"),d()())}u.register(...W);var H=class o{constructor(t,e){this.dataService=t;this.dashboardControllerService=e}dataSource="default";title="Distribuzione Voti Consiglieri";customData;sectionId;hasData=!1;updateSubscription;onResize(){this.setupChartOptions(),setTimeout(()=>{let t=u.instances;for(let e in t)t[e].resize()},100)}getChartHeight(){let t=window.innerWidth;return t<=400?"200px":t<=768?"240px":"280px"}ngOnInit(){this.setupChartOptions(),this.customData?this.pieChartData=this.customData:(this.loadChartData(),this.updateSubscription=x(121*1e3).subscribe(()=>{this.loadChartData()}))}ngOnChanges(t){this.loadChartData()}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}pieChartData={labels:[],datasets:[{data:[],backgroundColor:[]}]};pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:10,font:{size:12}}},tooltip:{callbacks:{label:function(t){let e=t.dataset,i=e.data.reduce((r,s)=>r+s,0),a=e.data[t.dataIndex],n=(a/i*100).toFixed(1);return`${a} (${n}%)`}}}}};setupChartOptions(){let t=window.innerWidth;t<=400?this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:8,padding:5,font:{size:10}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:10},padding:4}}}:t<=768?this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:10,padding:8,font:{size:11}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:11},padding:6}}}:this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:10,font:{size:12}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:12},padding:8}}}}loadChartData(){switch(this.dataSource){case"votes":this.dashboardControllerService.globalStats().subscribe(t=>{let e=t.blanks??0,i=t.nulls??0,n=(t.totalVotes??0)-i-e;this.pieChartData={labels:["Schede Valide","Schede Bianche","Schede Nulle"],datasets:[{data:[n,e,i],backgroundColor:this.generateColors(3)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(r=>r>0)});break;case"seat-votes":if(!this.sectionId||this.sectionId<0)break;this.dashboardControllerService.globalSectionStats1(this.sectionId).subscribe(t=>{let e=t.blanks??0,i=t.nulls??0,n=(t.totalVotes??0)-i-e;this.pieChartData={labels:["Schede Valide","Schede Bianche","Schede Nulle"],datasets:[{data:[n,e,i],backgroundColor:this.generateColors(3)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(r=>r>0)});break;case"mayors":this.dashboardControllerService.mayorsTotalVotes().subscribe(t=>{let e=window.innerWidth,i=t.map(a=>e<=480&&a.name&&a.name.length>8?a.name.substring(0,6)+"..":e<=768&&a.name&&a.name.length>12?a.name.substring(0,10)+"..":a.name);this.pieChartData={labels:i,datasets:[{data:t.map(a=>a.votes||0),backgroundColor:this.generateColors(t.length)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(a=>a>0)});break;case"seat-mayors":if(!this.sectionId||this.sectionId<0)break;this.dashboardControllerService.globalSectionStats1(this.sectionId).pipe(f(t=>t.mayors||[])).subscribe(t=>{let e=window.innerWidth,i=t.map(a=>e<=480&&a.name&&a.name.length>8?a.name.substring(0,6)+"..":e<=768&&a.name&&a.name.length>12?a.name.substring(0,10)+"..":a.name);this.pieChartData={labels:i,datasets:[{data:t.map(a=>a.votes||0),backgroundColor:this.generateColors(t.length)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(a=>a>0)});break;case"default":default:this.dataService.getPieChartData().subscribe(t=>{this.pieChartData=t});break}}generateColors(t){let e=["#FF1F54","#1A7BC2","#FFB726","#329A9A","#7733FF","#FF8307","#FF9124","#FF9F40","#FFAD5C","#FFBB78","#FF4169","#FF6384","#FF859F","#FFA7BA","#2890D6","#36A2EB","#54B4F0","#72C6F5","#FFC23E","#FFCE56","#FFDA6E","#FFE686","#3FADAD","#4BC0C0","#67CDCD","#83DADA","#884DFF","#9966FF","#AA80FF","#BB99FF"];return Array(t).fill(0).map((i,a)=>e[a%e.length])}static \u0275fac=function(e){return new(e||o)(m(C),m(E))};static \u0275cmp=F({type:o,selectors:[["app-pie-chart"]],hostBindings:function(e,i){e&1&&_("resize",function(){return i.onResize()},!1,D)},inputs:{dataSource:"dataSource",title:"title",customData:"customData",sectionId:"sectionId"},features:[v],decls:7,vars:6,consts:[["noData",""],[1,"chart-container"],[1,"chart-wrapper",3,"ngStyle"],[4,"ngIf","ngIfElse"],["baseChart","",3,"data","options","type"],[1,"no-data-message"]],template:function(e,i){if(e&1&&(h(0,"div",1)(1,"h3"),g(2),d(),h(3,"div",2),S(4,J,2,3,"ng-container",3)(5,K,3,0,"ng-template",null,0,z),d()()),e&2){let a=P(6);c(2),A(i.title),c(),p("ngStyle",M(4,q,i.getChartHeight())),c(),p("ngIf",i.hasData)("ngIfElse",a)}},dependencies:[V,B,k,$],styles:['@charset "UTF-8";.chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#2c3e50;font-size:16px;text-align:center}.chart-wrapper[_ngcontent-%COMP%]{flex:1;position:relative;min-height:0;max-height:100%}.no-data-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;min-height:200px;background-color:#f8f9fa;border-radius:8px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;font-size:1.1em}@media (max-width: 768px){.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:15px;margin-bottom:10px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1em}}@media (max-width: 480px){.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.no-data-message[_ngcontent-%COMP%]{min-height:150px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9em}}  .chart-col{display:flex;flex-direction:column;height:auto;min-height:300px;max-height:none}  .chart-wrapper{flex:1;position:relative;width:100%;overflow:visible}  .chart-container{height:100%;width:100%;display:flex;flex-direction:column}@media (max-width: 768px){  .chart-col{min-height:280px;padding:12px!important}  canvas{height:100%!important;width:100%!important;margin:0 auto!important}  .chart-wrapper{height:250px}}@media (max-width: 480px){  .chart-col{min-height:250px;padding:10px!important}  .chart-wrapper{height:220px}}@media (max-width: 768px){  .chart-col canvas{max-height:calc(100% - 60px)!important}  .chart-col .chartjs-legend ul{display:flex;flex-wrap:wrap;justify-content:center}  .chart-col .chartjs-legend li{margin:0 5px 5px 0;font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100px}}']})};var Q=o=>({height:o});function X(o,t){if(o&1&&(O(0),w(1,"canvas",4),y()),o&2){let e=I();c(),p("data",e.pieChartData)("options",e.pieChartOptions)("type","pie")}}function Y(o,t){o&1&&(h(0,"div",5)(1,"p"),g(2,"Nessun dato disponibile"),d()())}u.register(...W);var T=class o{constructor(t,e){this.dataService=t;this.dashboardControllerService=e}dataSource="default";title="Distribuzione Voti Consiglieri";customData;sectionId;hasData=!1;updateSubscription;onResize(){this.setupChartOptions(),setTimeout(()=>{let t=u.instances;for(let e in t)t[e].resize()},100)}getChartHeight(){let t=window.innerWidth;return t<=400?"200px":t<=768?"240px":"280px"}ngOnInit(){this.setupChartOptions(),this.customData?this.pieChartData=this.customData:(this.loadChartData(),this.updateSubscription=x(121*1e3).subscribe(()=>{this.loadChartData()}))}ngOnChanges(t){this.loadChartData()}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}pieChartData={labels:[],datasets:[{data:[],backgroundColor:[]}]};pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:10,font:{size:12}}},tooltip:{callbacks:{label:function(t){let e=t.dataset,i=e.data.reduce((r,s)=>r+s,0),a=e.data[t.dataIndex],n=(a/i*100).toFixed(1);return`${a} (${n}%)`}}}}};setupChartOptions(){let t=window.innerWidth;t<=400?this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:8,padding:5,font:{size:10}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:10},padding:4}}}:t<=768?this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:10,padding:8,font:{size:11}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:11},padding:6}}}:this.pieChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:12,padding:10,font:{size:12}}},tooltip:{callbacks:{label:function(e){let i=e.dataset,a=i.data.reduce((s,l)=>s+l,0),n=i.data[e.dataIndex],r=(n/a*100).toFixed(1);return`${n} (${r}%)`}},bodyFont:{size:12},padding:8}}}}loadChartData(){switch(this.dataSource){case"councillors":this.dashboardControllerService.councillorsTotalVotes().pipe(f(t=>t.slice(0,20))).subscribe(t=>{let e=window.innerWidth,i=t.map(a=>e<=400&&a.name&&a.name.length>10?a.name.substring(0,8)+"...":a.name);this.pieChartData={labels:i,datasets:[{data:t.map(a=>a.votes||0),backgroundColor:this.generateColors(t.length)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(a=>a>0)});break;case"seat-councillors":if(!this.sectionId||this.sectionId<0)break;this.dashboardControllerService.globalSectionStats1(this.sectionId).pipe(f(t=>t.councilors?.slice(0,20)||[])).subscribe(t=>{let e=window.innerWidth,i=t.map(a=>e<=400&&a.name&&a.name.length>10?a.name.substring(0,8)+"...":a.name);this.pieChartData={labels:i,datasets:[{data:t.map(a=>a.votes||0),backgroundColor:this.generateColors(t.length)}]},this.hasData=this.pieChartData.datasets.length>0&&this.pieChartData.datasets[0].data.some(a=>a>0)});break;case"default":default:this.dataService.getPieChartData().subscribe(t=>{this.pieChartData=t});break}}generateColors(t){let e=["#FF1F54","#FF4169","#FF6384","#FF859F","#FFA7BA","#1A7BC2","#2890D6","#36A2EB","#54B4F0","#72C6F5","#FFB726","#FFC23E","#FFCE56","#FFDA6E","#FFE686","#329A9A","#3FADAD","#4BC0C0","#67CDCD","#83DADA","#7733FF","#884DFF","#9966FF","#AA80FF","#BB99FF","#FF8307","#FF9124","#FF9F40","#FFAD5C","#FFBB78"];return Array(t).fill(0).map((i,a)=>e[a%e.length])}static \u0275fac=function(e){return new(e||o)(m(C),m(E))};static \u0275cmp=F({type:o,selectors:[["app-bar-chart"]],hostBindings:function(e,i){e&1&&_("resize",function(){return i.onResize()},!1,D)},inputs:{dataSource:"dataSource",title:"title",customData:"customData",sectionId:"sectionId"},features:[v],decls:7,vars:6,consts:[["noData",""],[1,"chart-container"],[1,"chart-wrapper",3,"ngStyle"],[4,"ngIf","ngIfElse"],["baseChart","",3,"data","options","type"],[1,"no-data-message"]],template:function(e,i){if(e&1&&(h(0,"div",1)(1,"h3"),g(2),d(),h(3,"div",2),S(4,X,2,3,"ng-container",3)(5,Y,3,0,"ng-template",null,0,z),d()()),e&2){let a=P(6);c(2),A(i.title),c(),p("ngStyle",M(4,Q,i.getChartHeight())),c(),p("ngIf",i.hasData)("ngIfElse",a)}},dependencies:[V,B,k,$],styles:['@charset "UTF-8";.chart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:15px;color:#2c3e50;font-size:16px;text-align:center}.chart-wrapper[_ngcontent-%COMP%]{flex:1;position:relative;min-height:0;max-height:100%}.no-data-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;min-height:200px;background-color:#f8f9fa;border-radius:8px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;font-size:1.1em}@media (max-width: 768px){.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:15px;margin-bottom:10px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1em}}@media (max-width: 480px){.chart-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.no-data-message[_ngcontent-%COMP%]{min-height:150px}.no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9em}}  .chart-col{display:flex;flex-direction:column;height:auto;min-height:300px;max-height:none}  .chart-wrapper{flex:1;position:relative;width:100%;overflow:visible}  .chart-container{height:100%;width:100%;display:flex;flex-direction:column}@media (max-width: 768px){  .chart-col{min-height:280px;padding:12px!important}  canvas{height:100%!important;width:100%!important;margin:0 auto!important}  .chart-wrapper{height:250px}}@media (max-width: 480px){  .chart-col{min-height:250px;padding:10px!important}  .chart-wrapper{height:220px}}@media (max-width: 768px){  .chart-col canvas{max-height:calc(100% - 60px)!important}  .chart-col .chartjs-legend ul{display:flex;flex-wrap:wrap;justify-content:center}  .chart-col .chartjs-legend li{margin:0 5px 5px 0;font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100px}}']})};export{H as a,T as b};
