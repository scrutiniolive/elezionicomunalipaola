import{a as M}from"./chunk-JODZXDCD.js";import{$ as f,$a as v,Ba as l,Ga as b,Ka as w,Lb as D,Nb as y,Ra as p,Va as r,Wa as c,Ya as h,Za as g,_ as m,_a as x,ab as s,ac as O,eb as C,fb as a,hb as _,rb as S,v as u,xa as d}from"./chunk-GCSXBDOU.js";function k(o,e){if(o&1){let t=x();h(0),r(1,"button",3),v("click",function(){m(t);let n=s();return f(n.downloadExcel())}),a(2," Scarica Report Excel "),c(),g()}if(o&2){let t=s();d(),p("disabled",!t.isAuthenticated)}}function T(o,e){if(o&1&&(r(0,"div",4)(1,"p"),a(2,"I risulati dei seggi potranno essere scaricati solo al termine degli scrutini."),c(),r(3,"p"),a(4,"Tempo rimanente:"),c(),r(5,"div",5),a(6),c()()),o&2){let t=s();d(6),_(" ",t.countdownDisplay," ")}}var E=class o{constructor(e,t){this.voteControllerService=e;this.authService=t}isAuthenticated=!1;countdownDisplay="";endDate=new Date("May 28, 2025 00:00:00").getTime();countdownSubscription;authSubscription;ngOnInit(){this.authSubscription=this.authService.isAuthenticated$.subscribe(e=>{this.isAuthenticated=e}),this.countdownSubscription=u(1e3).subscribe(()=>{this.updateCountdown()}),this.updateCountdown()}ngOnDestroy(){this.countdownSubscription&&this.countdownSubscription.unsubscribe(),this.authSubscription&&this.authSubscription.unsubscribe()}downloadExcel(){this.isAuthenticated&&this.voteControllerService.exportToExcel().subscribe({next:e=>{let t=new Blob([e],{type:"application/vnd.ms-excel"}),i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download="risultati_voto.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)},error:e=>{console.error("Errore durante il download:",e)}})}updateCountdown(){let e=new Date().getTime(),t=this.endDate-e;if(t<0){this.countdownDisplay="Scaduto";return}let i=Math.floor(t/(1e3*60*60*24)),n=Math.floor(t%(1e3*60*60*24)/(1e3*60*60)),I=Math.floor(t%(1e3*60*60)/(1e3*60)),A=Math.floor(t%(1e3*60)/1e3);this.countdownDisplay=`${i}g ${n}h ${I}m ${A}s`}static \u0275fac=function(t){return new(t||o)(l(O),l(M))};static \u0275cmp=b({type:o,selectors:[["app-download"]],decls:4,vars:2,consts:[["notAuthenticatedTemplate",""],[1,"download-container"],[4,"ngIf","ngIfElse"],[1,"download-button",3,"click","disabled"],[1,"disclaimer"],[1,"countdown"]],template:function(t,i){if(t&1&&(r(0,"div",1),w(1,k,3,1,"ng-container",2)(2,T,7,1,"ng-template",null,0,S),c()),t&2){let n=C(3);d(),p("ngIf",i.isAuthenticated)("ngIfElse",n)}},dependencies:[y,D],styles:[".download-container[_ngcontent-%COMP%]{padding:20px;text-align:center}.download-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#4caf50;color:#fff;border:none;border-radius:4px;cursor:pointer}.download-button[_ngcontent-%COMP%]:hover{background-color:#45a049}.download-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.disclaimer[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e9ecef;border-radius:4px;padding:15px;margin-top:20px}.disclaimer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;color:#495057}.countdown[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#dc3545;margin:10px 0}"]})};export{E as DownloadComponent};
